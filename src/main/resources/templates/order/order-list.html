<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="~{layout/header :: header}"></th:block>
</head>
<body>
<th:block th:replace="~{layout/header :: header}"></th:block>

<div class="container my-5">
    <h2 class="fw-bold mb-4">
        <i class="bi bi-receipt"></i> Đơn hàng của tôi
    </h2>

    <!-- Filter Tabs -->
    <ul class="nav nav-pills mb-4">
        <li class="nav-item">
            <a class="nav-link" th:classappend="${status == null} ? 'active'"
               th:href="@{/orders}">Tất cả</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" th:classappend="${status == 0} ? 'active'"
               th:href="@{/orders(status=0)}">Chờ xác nhận</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" th:classappend="${status == 1} ? 'active'"
               th:href="@{/orders(status=1)}">Đang giao</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" th:classappend="${status == 2} ? 'active'"
               th:href="@{/orders(status=2)}">Đã giao</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" th:classappend="${status == 3} ? 'active'"
               th:href="@{/orders(status=3)}">Đã hủy</a>
        </li>
    </ul>

    <!-- Orders List -->
    <div class="row" th:if="${orders != null && !orders.isEmpty()}">
        <div class="col-12" th:each="order : ${orders}">
            <div class="card shadow-sm mb-3">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="mb-0">
                            Đơn hàng #<span th:text="${order.id}">001</span>
                        </h6>
                        <small class="text-muted"
                               th:text="${#temporals.format(order.createDate, 'dd/MM/yyyy HH:mm')}">
                            01/01/2024 10:00
                        </small>
                    </div>
                    <div>
                        <span class="badge bg-warning" th:if="${order.status == 0}">Chờ xác nhận</span>
                        <span class="badge bg-info" th:if="${order.status == 1}">Đang giao</span>
                        <span class="badge bg-success" th:if="${order.status == 2}">Đã giao</span>
                        <span class="badge bg-danger" th:if="${order.status == 3}">Đã hủy</span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="mb-2" th:each="detail : ${order.orderDetails}">
                                <div class="d-flex align-items-center">
                                    <img th:src="@{${detail.product.image}}" alt=""
                                         style="width: 60px; height: 60px; object-fit: cover;"
                                         class="rounded me-3"
                                         onerror="this.src='https://via.placeholder.com/60'">
                                    <div class="flex-grow-1">
                                        <h6 class="mb-0" th:text="${detail.product.name}">Product</h6>
                                        <small class="text-muted">
                                            Số lượng: <span th:text="${detail.quantity}">1</span> x
                                            <span th:text="${#numbers.formatDecimal(detail.price, 0, 'COMMA', 0, 'POINT')} + 'đ'">0đ</span>
                                        </small>
                                    </div>
                                    <strong th:text="${#numbers.formatDecimal(detail.price * detail.quantity, 0, 'COMMA', 0, 'POINT')} + 'đ'">
                                        0đ
                                    </strong>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <p class="mb-2">
                                <strong>Tổng tiền:</strong>
                                <span class="text-primary fs-5 ms-2"
                                      th:text="${#numbers.formatDecimal(order.totalAmount, 0, 'COMMA', 0, 'POINT')} + 'đ'">
                                        0đ
                                    </span>
                            </p>
                            <p class="mb-2 small text-muted">
                                <i class="bi bi-credit-card"></i>
                                <span th:text="${order.paymentMethod}">COD</span>
                            </p>
                            <div class="d-grid gap-2">
                                <a th:href="@{/orders/{id}(id=${order.id})}"
                                   class="btn btn-sm btn-outline-primary">
                                    <i class="bi bi-eye"></i> Chi tiết
                                </a>
                                <button type="button" class="btn btn-sm btn-outline-danger"
                                        th:if="${order.status == 0}"
                                        onclick="return confirm('Bạn có chắc muốn hủy đơn hàng này?')">
                                    <i class="bi bi-x-circle"></i> Hủy đơn
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Empty State -->
    <div class="text-center py-5" th:if="${orders == null || orders.isEmpty()}">
        <i class="bi bi-inbox display-1 text-muted"></i>
        <h3 class="mt-3">Chưa có đơn hàng nào</h3>
        <p class="text-muted">Bạn chưa có đơn hàng nào trong hệ thống</p>
        <a th:href="@{/products}" class="btn btn-primary">
            <i class="bi bi-bag"></i> Mua sắm ngay
        </a>
    </div>
</div>

<th:block th:replace="~{layout/footer :: footer}"></th:block>
</body>
</html>
