<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head><th:block th:replace="~{layout/header :: head('Chi tiết sản phẩm')}"></th:block></head>
<body>
<th:block th:replace="~{layout/header :: navbar}"></th:block>

<div class="container my-4" th:if="${product != null}">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a th:href="@{/}">Trang chủ</a></li>
            <li class="breadcrumb-item"><a th:href="@{/product/list-by-category/{id}(id=${product.category.id})}" th:text="${product.category.name}">Category</a></li>
            <li class="breadcrumb-item active" th:text="${product.name}">Product</li>
        </ol>
    </nav>

    <div class="row g-4">
        <div class="col-md-6">
            <img class="img-fluid rounded" th:src="@{${product.image}}" onerror="this.src='https://via.placeholder.com/600x600?text=No+Image'">
        </div>
        <div class="col-md-6">
            <h3 th:text="${product.name}">Product</h3>
            <p><span class="badge bg-primary" th:text="${product.category.name}">Category</span></p>
            <h2 class="text-danger" th:text="${#numbers.formatDecimal(product.price,0,'COMMA',0,'POINT')} + ' ₫'">0 ₫</h2>

            <form th:action="@{/cart/add/{productId}(productId=${product.id})}" method="post" class="my-3">
                <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}">
                <div class="input-group" style="max-width: 220px;">
                    <span class="input-group-text">SL</span>
                    <input type="number" class="form-control" name="quantity" value="1" min="1" th:max="${product.quantity}">
                    <button class="btn btn-primary"><i class="fas fa-cart-plus"></i> Thêm giỏ</button>
                </div>
                <small class="text-muted d-block mt-2">Còn <b th:text="${product.quantity}">0</b> sản phẩm</small>
            </form>
        </div>
    </div>

    <hr class="my-5">

    <h5 class="mb-3">Sản phẩm cùng loại</h5>
    <div class="row g-4">
        <div class="col-6 col-md-3" th:each="rp : ${relatedProducts}">
            <div class="card h-100">
                <img th:src="@{${rp.image}}" class="card-img-top" style="height:200px;object-fit:cover" onerror="this.src='https://via.placeholder.com/300x200?text=No+Image'">
                <div class="card-body">
                    <h6 class="card-title text-truncate" th:text="${rp.name}">Product</h6>
                    <p class="text-danger" th:text="${#numbers.formatDecimal(rp.price,0,'COMMA',0,'POINT')} + ' ₫'">0 ₫</p>
                    <a th:href="@{/product/detail/{id}(id=${rp.id})}" class="btn btn-sm btn-outline-primary w-100">Chi tiết</a>
                </div>
            </div>
        </div>
    </div>
</div>

<th:block th:replace="~{layout/footer :: footer}"></th:block>
<th:block th:replace="~{layout/footer :: scripts}"></th:block>
</body>
</html>
