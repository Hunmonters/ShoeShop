<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="~{layout/header :: header}"></th:block>
</head>
<body>
<th:block th:replace="~{layout/header :: header}"></th:block>

<div class="container my-5">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a th:href="@{/}">Trang chủ</a></li>
            <li class="breadcrumb-item"><a th:href="@{/products}">Sản phẩm</a></li>
            <li class="breadcrumb-item active" th:text="${product.name}">Product</li>
        </ol>
    </nav>

    <div class="row">
        <!-- Product Image -->
        <div class="col-md-6 mb-4">
            <div class="card shadow-sm">
                <img th:src="@{${product.image}}" class="card-img-top p-4" alt=""
                     onerror="this.src='https://via.placeholder.com/600x600/cccccc/ffffff?text=No+Image'">
            </div>
        </div>

        <!-- Product Info -->
        <div class="col-md-6">
            <div class="card shadow-sm p-4">
                <h2 class="fw-bold mb-3" th:text="${product.name}">Product Name</h2>

                <div class="mb-3">
                    <span class="badge bg-primary me-2" th:text="${product.category.name}">Category</span>
                    <span class="badge bg-success" th:if="${product.quantity > 10}">Còn hàng</span>
                    <span class="badge bg-warning" th:if="${product.quantity <= 10 && product.quantity > 0}">
                            Sắp hết
                        </span>
                    <span class="badge bg-danger" th:if="${product.quantity == 0}">Hết hàng</span>
                </div>

                <h3 class="text-primary fw-bold mb-4"
                    th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + ' đ'">
                    0 đ
                </h3>

                <div class="mb-4">
                    <h5 class="fw-bold">Mô tả sản phẩm</h5>
                    <p class="text-muted">
                        Giày thể thao chất lượng cao, thiết kế hiện đại, phù hợp cho mọi hoạt động.
                        Chất liệu cao cấp, thoáng khí và bền bỉ. Đế giày êm ái, hỗ trợ tốt khi vận động.
                    </p>
                    <ul class="text-muted">
                        <li>Chất liệu: Da tổng hợp + Vải cao cấp</li>
                        <li>Đế: Cao su non, chống trơn trượt</li>
                        <li>Phù hợp: Đi bộ, chạy bộ, tập gym</li>
                        <li>Bảo hành: 6 tháng</li>
                    </ul>
                </div>

                <form th:action="@{/cart/add}" method="post" th:if="${product.quantity > 0}">
                    <input type="hidden" name="productId" th:value="${product.id}">

                    <div class="mb-4">
                        <label class="form-label fw-bold">Số lượng:</label>
                        <div class="input-group" style="max-width: 150px;">
                            <button class="btn btn-outline-secondary" type="button" onclick="decreaseQty()">
                                <i class="bi bi-dash"></i>
                            </button>
                            <input type="number" class="form-control text-center" name="quantity"
                                   id="quantity" value="1" min="1" th:max="${product.quantity}">
                            <button class="btn btn-outline-secondary" type="button" onclick="increaseQty()">
                                <i class="bi bi-plus"></i>
                            </button>
                        </div>
                        <small class="text-muted">
                            Còn <span th:text="${product.quantity}">0</span> sản phẩm
                        </small>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="bi bi-cart-plus"></i> Thêm vào giỏ hàng
                        </button>
                        <a th:href="@{/products}" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-left"></i> Tiếp tục mua sắm
                        </a>
                    </div>
                </form>

                <div th:if="${product.quantity == 0}" class="alert alert-danger">
                    <i class="bi bi-exclamation-triangle"></i> Sản phẩm tạm thời hết hàng
                </div>

                <hr class="my-4">

                <div class="row text-center g-3">
                    <div class="col-4">
                        <i class="bi bi-truck fs-3 text-primary"></i>
                        <p class="small mb-0">Giao hàng nhanh</p>
                    </div>
                    <div class="col-4">
                        <i class="bi bi-arrow-repeat fs-3 text-success"></i>
                        <p class="small mb-0">Đổi trả 7 ngày</p>
                    </div>
                    <div class="col-4">
                        <i class="bi bi-shield-check fs-3 text-info"></i>
                        <p class="small mb-0">Chính hãng 100%</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Related Products -->
    <section class="mt-5">
        <h3 class="fw-bold mb-4">Sản phẩm liên quan</h3>
        <div class="row g-4">
            <div class="col-lg-3 col-md-4 col-sm-6" th:each="related : ${relatedProducts}">
                <div class="card h-100 shadow-sm product-card">
                    <img th:src="@{${related.image}}" class="card-img-top" alt=""
                         onerror="this.src='https://via.placeholder.com/300x300/cccccc/ffffff?text=No+Image'">
                    <div class="card-body">
                        <h6 class="card-title" th:text="${related.name}">Product</h6>
                        <p class="text-primary fw-bold mb-2"
                           th:text="${#numbers.formatDecimal(related.price, 0, 'COMMA', 0, 'POINT')} + ' đ'">0 đ</p>
                        <a th:href="@{/products/{id}(id=${related.id})}" class="btn btn-sm btn-outline-primary w-100">
                            Xem chi tiết
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<script>
    function increaseQty() {
        let input = document.getElementById('quantity');
        let max = parseInt(input.getAttribute('max'));
        let current = parseInt(input.value);
        if (current < max) {
            input.value = current + 1;
        }
    }

    function decreaseQty() {
        let input = document.getElementById('quantity');
        let current = parseInt(input.value);
        if (current > 1) {
            input.value = current - 1;
        }
    }
</script>

<th:block th:replace="~{layout/footer :: footer}"></th:block>
</body>
</html>